<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Picker Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen transition-all duration-500" id="pageBody">
    <nav class="bg-white shadow-md mb-8">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex space-x-8">
                    <a href="/" class="text-purple-600 hover:text-purple-800 font-medium">üéØ Smart Pick</a>
                    <a href="/movies" class="text-blue-600 hover:text-blue-800 font-medium">üé¨ Movies</a>
                    <a href="/jobs" class="text-green-600 hover:text-green-800 font-medium">üíº Jobs</a>
                    <a href="/grocery" class="text-orange-600 hover:text-orange-800 font-medium">üõí Grocery</a>
                </div>
                <div class="flex items-center space-x-4">
                    {% if user %}
                        <span class="text-gray-700">Welcome, {{ user.username }}!</span>
                        <a href="/profile" class="text-purple-600 hover:text-purple-800 font-medium">üë§ Profile</a>
                        <a href="/logout" class="text-red-600 hover:text-red-800 font-medium">üö™ Logout</a>
                    {% else %}
                        <a href="/login" class="text-blue-600 hover:text-blue-800 font-medium">üîë Login</a>
                        <a href="/register" class="text-green-600 hover:text-green-800 font-medium">üìù Register</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-6">
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-orange-600 mb-2">üõí Smart Grocery</h1>
            <p class="text-gray-600">Pick recipes ‚Üí Get smart grocery list</p>
        </header>

        <!-- Quick Actions -->
        <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg p-4 mb-6">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="text-center md:text-left">
                    <h2 class="text-lg font-semibold">Quick Start</h2>
                    <p class="text-sm opacity-90">Select popular recipes instantly</p>
                </div>
                <div class="flex flex-wrap gap-2 justify-center">
                    <button onclick="searchRecipes('Curry')" class="bg-white text-orange-600 px-3 py-1 rounded text-sm font-medium hover:bg-gray-100">üçõ Indian Food</button>
                    <button onclick="filterByCategory('fast-food')" class="bg-white text-orange-600 px-3 py-1 rounded text-sm font-medium hover:bg-gray-100">üçü Fast Food</button>
                    <button onclick="filterByCategory('cakes')" class="bg-white text-orange-600 px-3 py-1 rounded text-sm font-medium hover:bg-gray-100">üéÇ Cakes</button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Search & Filter Panel -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-md p-4 sticky top-4">
                    <h3 class="text-lg font-semibold mb-4">üîç Find Recipes</h3>
                    
                    <!-- Search Box -->
                    <div class="mb-4">
                        <input type="text" id="recipeSearch" placeholder="Search recipes..." class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    </div>
                    
                    <!-- Popular Categories -->
                    <div class="mb-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">Popular</h4>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="searchRecipes('Chicken')" class="bg-orange-100 hover:bg-orange-200 text-orange-800 px-3 py-2 rounded text-sm">üçó Chicken</button>
                            <button onclick="searchRecipes('Dal')" class="bg-green-100 hover:bg-green-200 text-green-800 px-3 py-2 rounded text-sm">üç≤ Dal</button>
                            <button onclick="searchRecipes('Pasta')" class="bg-red-100 hover:bg-red-200 text-red-800 px-3 py-2 rounded text-sm">üçù Pasta</button>
                            <button onclick="searchRecipes('Biryani')" class="bg-yellow-100 hover:bg-yellow-200 text-yellow-800 px-3 py-2 rounded text-sm">üçõ Biryani</button>
                        </div>
                    </div>
                    
                    <!-- Special Categories -->
                    <div class="mb-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">Special</h4>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="filterByCategory('fast-food')" class="bg-pink-100 hover:bg-pink-200 text-pink-800 px-3 py-2 rounded text-sm">üçü Fast Food</button>
                            <button onclick="filterByCategory('cakes')" class="bg-purple-100 hover:bg-purple-200 text-purple-800 px-3 py-2 rounded text-sm">üéÇ Cakes</button>
                        </div>
                    </div>
                    
                    <!-- Quick Filters -->
                    <div class="mb-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">Quick Filters</h4>
                        <div class="space-y-2">
                            <button onclick="filterByType('veg')" id="vegFilter" class="w-full bg-green-50 hover:bg-green-100 text-green-700 px-3 py-2 rounded text-sm text-left transition-all duration-300">üå± Vegetarian</button>
                            <button onclick="filterByType('non-veg')" id="nonVegFilter" class="w-full bg-red-50 hover:bg-red-100 text-red-700 px-3 py-2 rounded text-sm text-left transition-all duration-300">üçó Non-Vegetarian</button>
                            <button onclick="filterByCategory('fast-food')" id="fastFoodFilter" class="w-full bg-pink-50 hover:bg-pink-100 text-pink-700 px-3 py-2 rounded text-sm text-left transition-all duration-300">üçü Fast Food</button>
                            <button onclick="filterByCategory('cakes')" id="cakesFilter" class="w-full bg-purple-50 hover:bg-purple-100 text-purple-700 px-3 py-2 rounded text-sm text-left transition-all duration-300">üéÇ Cakes & Desserts</button>
                            <button onclick="showAllRecipes()" id="allFilter" class="w-full bg-gray-50 hover:bg-gray-100 text-gray-700 px-3 py-2 rounded text-sm text-left transition-all duration-300">üìã Show All</button>
                        </div>
                    </div>
                    
                    <!-- Person Count Selector -->
                    <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">üë• How many people?</h4>
                        <div class="flex items-center justify-center space-x-3">
                            <button onclick="changePersonCount(-1)" class="bg-blue-500 hover:bg-blue-600 text-white w-8 h-8 rounded-full text-lg font-bold">-</button>
                            <span class="text-xl font-bold text-blue-700" id="personCount">4</span>
                            <button onclick="changePersonCount(1)" class="bg-blue-500 hover:bg-blue-600 text-white w-8 h-8 rounded-full text-lg font-bold">+</button>
                        </div>
                        <p class="text-xs text-blue-600 text-center mt-1">Quantities will be calculated accordingly</p>
                    </div>
                    
                    <!-- Selected Count & Generate Button -->
                    <div class="border-t pt-4">
                        <div class="text-center mb-3">
                            <span class="text-sm text-gray-600" id="selectedCount">0 recipes selected</span>
                        </div>
                        <button onclick="generateGroceryList()" class="w-full bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">üõí Create List</button>
                        <button onclick="clearAll()" class="w-full mt-2 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg text-sm">Clear All</button>
                    </div>
                </div>
            </div>
            
            <!-- Recipes Grid -->
            <div class="lg:col-span-2">
                <div class="mb-4 flex items-center justify-between">
                    <h3 class="text-lg font-semibold">Select Recipes</h3>
                    <div class="flex items-center gap-4">
                        <span class="text-sm text-gray-500" id="recipeCount">{{ recipes|length }} recipes</span>
                        <select id="itemsPerPage" class="text-xs border rounded px-2 py-1" onchange="changeItemsPerPage()">
                            <option value="20">20 per page</option>
                            <option value="50" selected>50 per page</option>
                        </select>
                    </div>
                </div>
                
                <!-- Pagination -->
                <div class="mb-4 flex items-center justify-between" id="paginationTop">
                    <div class="flex items-center gap-2">
                        <button onclick="changePage(-1)" id="prevBtn" class="px-3 py-1 bg-gray-200 rounded text-sm hover:bg-gray-300 disabled:opacity-50" disabled>‚Üê Prev</button>
                        <span class="text-sm text-gray-600" id="pageInfo">Page 1 of 1</span>
                        <button onclick="changePage(1)" id="nextBtn" class="px-3 py-1 bg-gray-200 rounded text-sm hover:bg-gray-300 disabled:opacity-50" disabled>Next ‚Üí</button>
                    </div>
                    <div class="text-xs text-gray-500" id="showingInfo">Showing 1-20</div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 min-h-[400px]" id="recipesGrid">
                    <!-- Recipes loaded via JavaScript -->
                </div>
                
                <!-- Bottom Pagination -->
                <div class="mt-4 flex justify-center">
                    <div class="flex items-center gap-2">
                        <button onclick="changePage(-1)" class="px-3 py-1 bg-gray-200 rounded text-sm hover:bg-gray-300 disabled:opacity-50" disabled>‚Üê Prev</button>
                        <span class="text-sm text-gray-600" id="pageInfoBottom">Page 1 of 1</span>
                        <button onclick="changePage(1)" class="px-3 py-1 bg-gray-200 rounded text-sm hover:bg-gray-300 disabled:opacity-50" disabled>Next ‚Üí</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Grocery List Modal/Section -->
        <div id="groceryList" class="mt-6"></div>
    </div>

    <script>
        const allRecipes = {{ recipes|tojson }};
        let currentFilter = 'all';
        let currentPage = 1;
        let itemsPerPage = 20;
        let filteredRecipes = Object.keys(allRecipes);
        
        // Search functionality
        document.getElementById('recipeSearch').addEventListener('input', function() {
            const query = this.value.toLowerCase().trim();
            if (query.length > 0) {
                searchRecipes(query);
            } else {
                showAllRecipes();
            }
        });
        
        function searchRecipes(query) {
            filteredRecipes = Object.keys(allRecipes).filter(recipe => 
                recipe.toLowerCase().includes(query.toLowerCase()) ||
                allRecipes[recipe].some(ingredient => ingredient.toLowerCase().includes(query.toLowerCase()))
            );
            currentPage = 1;
            updateRecipeDisplay();
            updateRecipeCount(filteredRecipes.length);
        }
        
        function updateRecipeDisplay() {
            const recipesGrid = document.getElementById('recipesGrid');
            
            if (filteredRecipes.length === 0) {
                recipesGrid.innerHTML = '<div class="col-span-2 text-center py-8 text-gray-500">No recipes found.</div>';
                updatePaginationControls();
                return;
            }
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const recipesToShow = filteredRecipes.slice(startIndex, endIndex);
            
            recipesGrid.innerHTML = recipesToShow.map(recipe => `
                <div class="bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-200 recipe-card border border-gray-100">
                    <label class="flex items-start p-2 cursor-pointer hover:bg-gray-50 rounded-lg">
                        <input type="checkbox" value="${recipe}" class="recipe-checkbox mt-1 mr-2 w-4 h-4 text-orange-600 rounded focus:ring-orange-500" onchange="updateSelectedCount()">
                        <div class="flex-1 min-w-0">
                            <h3 class="font-medium text-gray-900 mb-1 truncate text-sm">${recipe}</h3>
                            <div class="text-xs text-gray-500 mb-1">${allRecipes[recipe].length} items</div>
                            <div class="flex flex-wrap gap-1">
                                ${allRecipes[recipe].slice(0, 2).map(ingredient => `<span class="bg-orange-50 text-orange-700 text-xs px-1 py-0.5 rounded">${ingredient}</span>`).join('')}
                                ${allRecipes[recipe].length > 2 ? `<span class="text-xs text-gray-400">+${allRecipes[recipe].length - 2}</span>` : ''}
                            </div>
                        </div>
                    </label>
                </div>
            `).join('');
            
            updatePaginationControls();
        }
        
        function updatePaginationControls() {
            const totalPages = Math.ceil(filteredRecipes.length / itemsPerPage);
            const startItem = (currentPage - 1) * itemsPerPage + 1;
            const endItem = Math.min(currentPage * itemsPerPage, filteredRecipes.length);
            
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('pageInfoBottom').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('showingInfo').textContent = `Showing ${startItem}-${endItem} of ${filteredRecipes.length}`;
            
            const prevBtns = document.querySelectorAll('#prevBtn, #paginationBottom button:first-child');
            const nextBtns = document.querySelectorAll('#nextBtn, #paginationBottom button:last-child');
            
            prevBtns.forEach(btn => btn.disabled = currentPage === 1);
            nextBtns.forEach(btn => btn.disabled = currentPage === totalPages || totalPages === 0);
        }
        
        function changePage(direction) {
            const totalPages = Math.ceil(filteredRecipes.length / itemsPerPage);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                updateRecipeDisplay();
                document.getElementById('recipesGrid').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        function changeItemsPerPage() {
            itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
            currentPage = 1;
            updateRecipeDisplay();
        }
        
        function updateSelectedCount() {
            const selected = document.querySelectorAll('.recipe-checkbox:checked').length;
            document.getElementById('selectedCount').textContent = `${selected} recipe${selected !== 1 ? 's' : ''} selected`;
        }
        
        function updateRecipeCount(count) {
            document.getElementById('recipeCount').textContent = `${count} recipes`;
        }
        
        function filterByType(type) {
            currentFilter = type;
            const pageBody = document.getElementById('pageBody');
            
            if (type === 'veg') {
                pageBody.className = 'bg-gradient-to-br from-green-100 to-green-200 min-h-screen transition-all duration-500';
                updateFilterButtons('veg');
                filteredRecipes = Object.keys(allRecipes).filter(recipe => {
                    const recipeLower = recipe.toLowerCase();
                    // Exclude all non-veg items
                    return !recipeLower.includes('chicken') && 
                           !recipeLower.includes('meat') && 
                           !recipeLower.includes('fish') && 
                           !recipeLower.includes('mutton') && 
                           !recipeLower.includes('prawn') &&
                           !recipeLower.includes('keema') &&
                           !recipeLower.includes('seekh') &&
                           !recipeLower.includes('tandoori') &&
                           !recipeLower.includes('korma') &&
                           !recipeLower.includes('tikka') &&
                           !recipeLower.includes('rogan') &&
                           !recipeLower.includes('cafreal') &&
                           !recipeLower.includes('xacuti') &&
                           !recipeLower.includes('kosha') &&
                           !recipeLower.includes('changezi') &&
                           !recipeLower.includes('amritsari') &&
                           !recipeLower.includes('chettinad') &&
                           !recipeLower.includes('malai') &&
                           !recipeLower.includes('sukka') &&
                           !recipeLower.includes('koliwada') &&
                           !recipeLower.includes('bombay duck') &&
                           !recipeLower.includes('hilsa') &&
                           !recipeLower.includes('laal maas') &&
                           !recipeLower.includes('goan') &&
                           !recipeLower.includes('bengali') &&
                           !recipeLower.includes('hyderabadi') &&
                           !(recipeLower.includes('biryani') && (recipeLower.includes('chicken') || recipeLower.includes('mutton')));
                });
            } else if (type === 'non-veg') {
                pageBody.className = 'bg-gradient-to-br from-orange-100 to-red-200 min-h-screen transition-all duration-500';
                updateFilterButtons('non-veg');
                filteredRecipes = Object.keys(allRecipes).filter(recipe => {
                    const recipeLower = recipe.toLowerCase();
                    return recipeLower.includes('chicken') || 
                           recipeLower.includes('meat') || 
                           recipeLower.includes('fish') || 
                           recipeLower.includes('mutton') || 
                           recipeLower.includes('prawn') ||
                           recipeLower.includes('keema') ||
                           recipeLower.includes('seekh') ||
                           recipeLower.includes('tandoori') ||
                           recipeLower.includes('tikka') ||
                           recipeLower.includes('rogan') ||
                           recipeLower.includes('cafreal') ||
                           recipeLower.includes('xacuti') ||
                           recipeLower.includes('kosha') ||
                           recipeLower.includes('changezi') ||
                           recipeLower.includes('amritsari') ||
                           recipeLower.includes('chettinad') ||
                           recipeLower.includes('malai') ||
                           recipeLower.includes('sukka') ||
                           recipeLower.includes('koliwada') ||
                           recipeLower.includes('bombay duck') ||
                           recipeLower.includes('hilsa') ||
                           recipeLower.includes('laal maas') ||
                           (recipeLower.includes('biryani') && (recipeLower.includes('chicken') || recipeLower.includes('mutton')));
                });
            } else {
                filteredRecipes = Object.keys(allRecipes);
            }
            
            currentPage = 1;
            updateRecipeDisplay();
            updateRecipeCount(filteredRecipes.length);
        }
        
        function showAllRecipes() {
            document.getElementById('recipeSearch').value = '';
            currentFilter = 'all';
            const pageBody = document.getElementById('pageBody');
            
            pageBody.className = 'bg-gradient-to-br from-purple-100 to-blue-200 min-h-screen transition-all duration-500';
            updateFilterButtons('all');
            
            filteredRecipes = Object.keys(allRecipes);
            currentPage = 1;
            updateRecipeDisplay();
            updateRecipeCount(filteredRecipes.length);
        }
        
        function updateFilterButtons(activeFilter) {
            // Reset all buttons
            document.getElementById('vegFilter').className = 'w-full bg-green-50 hover:bg-green-100 text-green-700 px-3 py-2 rounded text-sm text-left transition-all duration-300';
            document.getElementById('nonVegFilter').className = 'w-full bg-red-50 hover:bg-red-100 text-red-700 px-3 py-2 rounded text-sm text-left transition-all duration-300';
            document.getElementById('fastFoodFilter').className = 'w-full bg-pink-50 hover:bg-pink-100 text-pink-700 px-3 py-2 rounded text-sm text-left transition-all duration-300';
            document.getElementById('cakesFilter').className = 'w-full bg-purple-50 hover:bg-purple-100 text-purple-700 px-3 py-2 rounded text-sm text-left transition-all duration-300';
            document.getElementById('allFilter').className = 'w-full bg-gray-50 hover:bg-gray-100 text-gray-700 px-3 py-2 rounded text-sm text-left transition-all duration-300';
            
            // Highlight active button
            if (activeFilter === 'veg') {
                document.getElementById('vegFilter').className = 'w-full bg-green-500 text-white px-3 py-2 rounded text-sm text-left transition-all duration-300 shadow-lg';
            } else if (activeFilter === 'non-veg') {
                document.getElementById('nonVegFilter').className = 'w-full bg-orange-500 text-white px-3 py-2 rounded text-sm text-left transition-all duration-300 shadow-lg';
            } else if (activeFilter === 'fast-food') {
                document.getElementById('fastFoodFilter').className = 'w-full bg-pink-500 text-white px-3 py-2 rounded text-sm text-left transition-all duration-300 shadow-lg';
            } else if (activeFilter === 'cakes') {
                document.getElementById('cakesFilter').className = 'w-full bg-purple-500 text-white px-3 py-2 rounded text-sm text-left transition-all duration-300 shadow-lg';
            } else if (activeFilter === 'all') {
                document.getElementById('allFilter').className = 'w-full bg-purple-500 text-white px-3 py-2 rounded text-sm text-left transition-all duration-300 shadow-lg';
            }
        }
        
        function filterByCategory(category) {
            currentFilter = category;
            const pageBody = document.getElementById('pageBody');
            
            if (category === 'fast-food') {
                pageBody.className = 'bg-gradient-to-br from-pink-100 to-red-200 min-h-screen transition-all duration-500';
                updateFilterButtons('fast-food');
                filteredRecipes = Object.keys(allRecipes).filter(recipe => {
                    const recipeLower = recipe.toLowerCase();
                    return recipeLower.includes('burger') || 
                           recipeLower.includes('pizza') || 
                           recipeLower.includes('sandwich') || 
                           recipeLower.includes('fries') || 
                           recipeLower.includes('hot dog') ||
                           recipeLower.includes('taco') ||
                           recipeLower.includes('wrap') ||
                           recipeLower.includes('nugget');
                });
            } else if (category === 'cakes') {
                pageBody.className = 'bg-gradient-to-br from-purple-100 to-pink-200 min-h-screen transition-all duration-500';
                updateFilterButtons('cakes');
                filteredRecipes = Object.keys(allRecipes).filter(recipe => {
                    const recipeLower = recipe.toLowerCase();
                    return recipeLower.includes('cake') || 
                           recipeLower.includes('cookie') || 
                           recipeLower.includes('pie') || 
                           recipeLower.includes('muffin') || 
                           recipeLower.includes('cupcake') ||
                           recipeLower.includes('brownie') ||
                           recipeLower.includes('donut') ||
                           recipeLower.includes('pastry');
                });
            }
            
            currentPage = 1;
            updateRecipeDisplay();
            updateRecipeCount(filteredRecipes.length);
        }
        

        
        function clearAll() {
            document.querySelectorAll('.recipe-checkbox').forEach(cb => cb.checked = false);
            updateSelectedCount();
            document.getElementById('groceryList').innerHTML = '';
        }
        
        let personCount = 4;
        
        function changePersonCount(change) {
            personCount = Math.max(1, Math.min(20, personCount + change));
            document.getElementById('personCount').textContent = personCount;
        }
        
        function generateGroceryList() {
            const checkboxes = document.querySelectorAll('.recipe-checkbox:checked');
            const selectedRecipes = Array.from(checkboxes).map(cb => cb.value);
            
            if (selectedRecipes.length === 0) {
                showNotification('Please select at least one recipe!', 'error');
                return;
            }
            
            // Show loading
            document.getElementById('groceryList').innerHTML = `
                <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto mb-2"></div>
                    <p class="text-gray-600">Creating your grocery list for ${personCount} people...</p>
                </div>
            `;

            fetch('/generate-list', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({recipes: selectedRecipes, persons: personCount})
            })
            .then(response => response.json())
            .then(data => {
                displayGroceryList(data, selectedRecipes);
                if (data.saved_to_basket) {
                    showNotification('Recipes saved to your basket!', 'success');
                }
            })
            .catch(error => {
                showNotification('Error generating list. Please try again.', 'error');
                console.error('Error:', error);
            });
        }
        
        function displayGroceryList(data, selectedRecipes) {
            const groceryDiv = document.getElementById('groceryList');
            let categoriesHtml = '';
            
            Object.keys(data.categorized_ingredients).forEach(category => {
                const items = data.categorized_ingredients[category];
                if (items.length > 0) {
                    categoriesHtml += `
                        <div class="mb-4">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <span class="w-3 h-3 bg-orange-500 rounded-full mr-2"></span>
                                ${category} (${items.length} items)
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                ${items.map(item => `
                                    <label class="flex items-center p-2 bg-gray-50 rounded hover:bg-gray-100 cursor-pointer">
                                        <input type="checkbox" class="mr-3 w-4 h-4 text-green-600 rounded">
                                        <span class="text-sm">${item}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            });
            
            groceryDiv.innerHTML = `
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="bg-gradient-to-r from-green-500 to-emerald-500 text-white p-4">
                        <h3 class="text-xl font-semibold mb-1">üõí Your Smart Grocery List</h3>
                        <p class="text-green-100 text-sm">${data.total_count} items from ${selectedRecipes.length} recipes for ${personCount} people</p>
                    </div>
                    
                    <div class="p-4">
                        <div class="mb-4 p-3 bg-blue-50 border-l-4 border-blue-400 rounded">
                            <p class="text-sm text-blue-800">${data.tip}</p>
                        </div>
                        
                        <div class="max-h-96 overflow-y-auto">
                            ${categoriesHtml}
                        </div>
                        
                        <div class="flex flex-wrap gap-2 mt-4 pt-4 border-t">
                            <button onclick="printGroceryList()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center">
                                üñ®Ô∏è Print List
                            </button>
                            <button onclick="shareGroceryList()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center">
                                üì± Share
                            </button>
                            <button onclick="document.getElementById('groceryList').innerHTML = ''" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                ‚úï Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Scroll to grocery list
            groceryDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        function printGroceryList() {
            const groceryContent = document.getElementById('groceryList').innerHTML;
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Grocery List</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .category { margin-bottom: 20px; }
                            .category h4 { color: #333; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
                            .item { margin: 5px 0; }
                        </style>
                    </head>
                    <body>${groceryContent}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        function shareGroceryList() {
            const selectedRecipes = Array.from(document.querySelectorAll('.recipe-checkbox:checked')).map(cb => cb.value);
            const shareText = `Check out my grocery list for these recipes: ${selectedRecipes.join(', ')}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'My Grocery List',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    showNotification('Grocery list copied to clipboard!', 'success');
                });
            }
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const bgColor = type === 'error' ? 'bg-red-500' : type === 'success' ? 'bg-green-500' : 'bg-blue-500';
            notification.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showAllRecipes();
        });
    </script>
</body>
</html>